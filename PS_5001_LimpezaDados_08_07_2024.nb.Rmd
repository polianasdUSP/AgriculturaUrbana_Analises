---
title: "Cleaning and Organization of Metadata"
output: html_notebook
---


 
Intalando pacotes necessários
```{r}
library(qiime2R)
library(phyloseq)
library(ggrepel)
library(gridExtra)
library(viridis)
library(ggpubr)
library(tidyverse)
library(dplyr)
library(ggpmisc)
library(ggplot2)
library(readr)


```

Importar metadados
```{r}
# Carregar o arquivo TSV usando read_tsv
metadados.raw <- read_tsv("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/metadados_raw_V01.tsv")


# Visualizar as primeiras linhas do dataframe
head(metadata)

str(metadata)


# Renomear a coluna "Parasitologico +" para "ParasitologicoPositivo"

#metadados.raw <- metadados.raw %>%
#  rename(ParasitologicoPositivo = `Parasitologico +`)

# Alterar os valores "não" para "nao" na coluna "Edulcorante?" do objeto metadados.raw
#metadados.raw$`Edulcorante?` <- gsub("não", "nao", metadados.raw$`Edulcorante?`)

# Renomear a coluna removendo o "?" do título
#colnames(metadados.raw)[colnames(metadados.raw) == "Edulcorante?"] <- "Edulcorante"

# Exportando o dataframe metadados.raw como um arquivo CSV, com ponto como separador decimal

write.csv(x = metadados.raw, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/metadados.raw.csv", row.names = FALSE)


```



Importar Alpha-diversity
Alpha-diversity indexes data:

```{r}
alpha.shannon.raw <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/shannon_vector.qza")$data

rownames(alpha.shannon.raw)

rownames(alpha.shannon)[grep("\\.F01$", rownames(alpha.shannon))]

alpha.shannon <- alpha.shannon.raw[
  !rownames(alpha.shannon.raw) %in% c("S10011.F01","S10012.F01",
    "S10021.F01", "S10031.F01", "S10041.F01", "S10051.F01", "S10052.F01", 
    "S10061.F01", "S10062.F01", "S10091.F01", "S10092.F01", "S10111.F01",
    "S10121.F01", "S10122.F01", "S10131.F01", "S10141.F01", "S10142.F01",
    "S10161.F01", "S10171.F01", 
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ), , drop = FALSE ]


colnames(alpha.shannon)

```


```{r}
alpha.evenness.raw <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/evenness_vector.qza")$data


alpha.evenness <- alpha.evenness.raw[
  !rownames(alpha.evenness.raw) %in% c("S10011.F01","S10012.F01",
    "S10021.F01", "S10031.F01", "S10041.F01", "S10051.F01", "S10052.F01", 
    "S10061.F01", "S10062.F01", "S10091.F01", "S10092.F01", "S10111.F01",
    "S10121.F01", "S10122.F01", "S10131.F01", "S10141.F01", "S10142.F01",
    "S10161.F01", "S10171.F01", 
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ), , drop = FALSE ]
```


```{r}
alpha.pd.raw <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/faith_pd_vector.qza")$data


#we need to fix the alpha.pd rownames and colnames as they are nameless for some reason
colnames(alpha.pd.raw) <- c("Sample.id", "faith_pd")

#Como alpha.pd.raw tem os IDs na coluna Sample.id (e não em rownames()), vamos aplicar a mesma filtragem usando a coluna, e não os rownames.

alpha.pd <- alpha.pd.raw[
  !alpha.pd.raw$Sample.id %in% c(
    "S10011.F01","S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ), ]
```


```{r}
observed.features.raw <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/observed_features_vector.qza")$data

alpha.observed.features<- observed.features.raw[
  !rownames(observed.features.raw) %in% c("S10011.F01","S10012.F01",
    "S10021.F01", "S10031.F01", "S10041.F01", "S10051.F01", "S10052.F01", 
    "S10061.F01", "S10062.F01", "S10091.F01", "S10092.F01", "S10111.F01",
    "S10121.F01", "S10122.F01", "S10131.F01", "S10141.F01", "S10142.F01",
    "S10161.F01", "S10171.F01", 
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ), , drop = FALSE ]


```

```{r}
alpha.simpson.raw <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/simpson_vector.qza")$data

alpha.simpson<- alpha.simpson.raw[
  !rownames(alpha.simpson.raw) %in% c("S10011.F01","S10012.F01",
    "S10021.F01", "S10031.F01", "S10041.F01", "S10051.F01", "S10052.F01", 
    "S10061.F01", "S10062.F01", "S10091.F01", "S10092.F01", "S10111.F01",
    "S10121.F01", "S10122.F01", "S10131.F01", "S10141.F01", "S10142.F01",
    "S10161.F01", "S10171.F01", "NEG_Run1_DNA_S5_L001", "NEG_Run2_DNA_S30_L001",                      
    "NEG_Run3_DNA_S54_L001", "NEG_Run4_DNA_S75_L001", "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001", "POSZymo_Run1_DNA_S6_L001", 
    "20240125-PCRNEG_S57_L001", "20240131-PCRNEG_S96_L001", "20240319_PCRNEG_S96_L001"
  ), , drop = FALSE ]

rownames(alpha.simpson)

```

```{r}
alpha.chao1.raw <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/chao1_vector.qza")$data

alpha.chao1<- alpha.chao1.raw[
  !rownames(alpha.chao1.raw) %in% c("S10011.F01","S10012.F01",
    "S10021.F01", "S10031.F01", "S10041.F01", "S10051.F01", "S10052.F01", 
    "S10061.F01", "S10062.F01", "S10091.F01", "S10092.F01", "S10111.F01",
    "S10121.F01", "S10122.F01", "S10131.F01", "S10141.F01", "S10142.F01",
    "S10161.F01", "S10171.F01", "NEG_Run1_DNA_S5_L001", "NEG_Run2_DNA_S30_L001",                      
    "NEG_Run3_DNA_S54_L001", "NEG_Run4_DNA_S75_L001", "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001", "POSZymo_Run1_DNA_S6_L001", 
    "20240125-PCRNEG_S57_L001", "20240131-PCRNEG_S96_L001", "20240319_PCRNEG_S96_L001"
  ), , drop = FALSE ]

rownames(alpha.chao1)

```

```{r}
#fazer um merge progressivo das colunas com as medidas de diversidade no objeto metadata, usando o ID das amostras.

#Assumindo que:

##Os IDs estão em rownames() nos objetos alpha.shannon, alpha.evenness, etc.
##Os IDs estão também em rownames(metadata).


# Transformar os objetos em data frames com Sample.id como coluna
alpha.shannon$Sample.id <- rownames(alpha.shannon)
alpha.evenness$Sample.id <- rownames(alpha.evenness)
alpha.pd$Sample.id <- alpha.pd$Sample.id  # Já tem Sample.id
alpha.observed.features$Sample.id <- rownames(alpha.observed.features)
alpha.simpson$Sample.id <- rownames(alpha.simpson)
alpha.chao1$Sample.id <- rownames(alpha.chao1)


# Juntar todas as tabelas de diversidade
metadata <- merge(metadata, alpha.shannon[, c("Sample.id", "shannon_entropy")], by.x = "row.names", by.y = "Sample.id", all.x = TRUE)
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL

metadata <- merge(metadata, alpha.evenness[, c("Sample.id", "pielou_evenness")], by.x = "row.names", by.y = "Sample.id", all.x = TRUE)
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL

metadata <- merge(metadata, alpha.pd[, c("Sample.id", "faith_pd")], by.x = "row.names", by.y = "Sample.id", all.x = TRUE)
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL

metadata <- merge(metadata, alpha.observed.features[, c("Sample.id", "observed_features")], by.x = "row.names", by.y = "Sample.id", all.x = TRUE)
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL

metadata <- merge(metadata, alpha.simpson[, c("Sample.id", "simpson")], by.x = "row.names", by.y = "Sample.id", all.x = TRUE)
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL

metadata <- merge(metadata, alpha.chao1[, c("Sample.id", "chao1")], by.x = "row.names", by.y = "Sample.id", all.x = TRUE)
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL


```

```{r}
unweighted_unifrac.raw <- as.matrix(read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/unweighted_unifrac_distance_matrix.qza")$data)


unweighted.unifrac <- unweighted_unifrac.raw[
  !rownames(unweighted_unifrac.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ),
  !colnames(unweighted_unifrac.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  )
]


colnames(unweighted.unifrac)
rownames(unweighted.unifrac)

```


```{r}
weighted_unifrac.raw <- as.matrix(read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/weighted_unifrac_distance_matrix.qza")$data)

weighted.unifrac <- weighted_unifrac.raw[
  !rownames(weighted_unifrac.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ),
  !colnames(weighted_unifrac.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  )
]

colnames(weighted.unifrac)
rownames(weighted.unifrac)

```

```{r}

bray.curtis.raw <- as.matrix(read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/bray_curtis_distance_matrix.qza")$data)

colnames(bray.curtis)


#limpar linhas e colunas sem criar vetor separado

bray.curtis <- bray.curtis.raw[
  !rownames(bray.curtis.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ),
  !colnames(bray.curtis.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  )
]



```

```{r}



jaccard.raw <- as.matrix(read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/core-metrics-results/jaccard_distance_matrix.qza")$data)



colnames(bray.curtis)


#limpar linhas e colunas sem criar vetor separado

jaccard <- jaccard.raw[
  !rownames(jaccard.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  ),
  !colnames(jaccard.raw) %in% c(
    "S10011.F01", "S10012.F01", "S10021.F01", "S10031.F01", "S10041.F01",
    "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01",
    "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01",
    "S10141.F01", "S10142.F01", "S10161.F01", "S10171.F01",
    "Pooled-Extractioncontrol-NEG_S56_L001",
    "Pooled-Extractioncontrol-POS-MOCK_S55_L001",
    "POSZymo_Run1_DNA_S6_L001"
  )
]



```

```{r}
library(qiime2R)

# Importar Bray-Curtis PCoA
pcoa_bray <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/core-metrics-results/bray_curtis_pcoa_results.qza")$data

colname(pcoa_bray)
```


```{r}
# Importar Jaccard PCoA
pcoa_jaccard <- read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/core-metrics-results/jaccard_pcoa_results.qza")$data





```



```{r}
ASV.table.raw<-read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Qiime/Analises_Corrigidas/table_corrigida.qza")$data
taxonomy<-read_qza("C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/taxonomy_silva.qza")$data

head(ASV.table.raw)

# Remover colunas específicas do ASV.table.raw
ASV.table.raw <- ASV.table.raw[, !colnames(ASV.table.raw) %in% c(
  "S10011.F01","S10012.F01","S10021.F01", "S10031.F01", "S10041.F01", 
  "S10051.F01", "S10052.F01", "S10061.F01", "S10062.F01", "S10091.F01", 
  "S10092.F01", "S10111.F01", "S10121.F01", "S10122.F01", "S10131.F01", 
  "S10141.F01", "S10142.F01", "NEG_Run1_DNA_S5_L001",
  "NEG_Run2_DNA_S30_L001", "NEG_Run3_DNA_S54_L001", "NEG_Run4_DNA_S75_L001", 
  "Pooled-Extractioncontrol-NEG_S56_L001", 
  "Pooled-Extractioncontrol-POS-MOCK_S55_L001", 
  "POSZymo_Run1_DNA_S6_L001", "20240125-PCRNEG_S57_L001", "20240131-PCRNEG_S96_L001",
  "20240319_PCRNEG_S96_L001"
)]


# transform counts in props
my.asvs <- data.frame(apply(X = ASV.table.raw, MARGIN = 2, FUN = function(x)x/sum(x)))

t.ASV.table.raw <- t(ASV.table.raw)



```

```{r}

ASV.table.raw$Col.names <- gsub("-", ".", alpha.all$Col.names)

```



#Merge all alpha diversity indexes 
```{r}

alpha.evenness.pd <- merge(alpha.evenness.raw, alpha.pd.raw, by = "row.names")
alpha.richness.shannon <- merge(alpha.richness.raw, alpha.shannon.raw, by = "row.names")

alpha.all <- merge(alpha.evenness.pd, alpha.richness.shannon, by = "Row.names")

write.csv(x = alpha.all, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/alpha.all.csv", row.names = FALSE)

```

#mudar os Sample.ids de -F00 para .F00
# Verifique se a coluna 'Sample.id' existe no data frame

```{r}

alpha.all$Row.names <- gsub("-", ".", alpha.all$Row.names)
  

#TIRAR de alpha.all todos os ids de Row.names que tejam finalizados por .F01
 # Remover IDs que terminam com .F01
alpha.all <- alpha.all[!grepl("\\.F01$", alpha.all$Row.names), ]

#Deixar só ids que terminam com .F00
alpha.all <- alpha.all[grepl("\\.F00$", alpha.all$Row.names), ] 

```

Limpar alpha.shannon (que é dataframe, ou seja, nao tem coluna com sample.id)
```{r}
# Substitui "-" por "." nos nomes das linhas do dataframe

rownames(alpha.shannon.raw) <- gsub("-", ".", rownames(alpha.shannon.raw))

# Filtra as linhas onde os nomes das linhas não terminam com ".F01"
alpha.shannon <- alpha.shannon.raw[!grepl("\\.F01$", rownames(alpha.shannon.raw)), , drop = FALSE]

# Filtra as linhas onde os nomes das linhas terminam com ".F00"
alpha.shannon <- alpha.shannon.raw[grepl("\\.F00$", rownames(alpha.shannon.raw)), , drop = FALSE]

write.csv(x = alpha.shannon, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/alpha.shannon.csv", row.names = FALSE)


```


Limpar alpha.pd (que é dataframe, ou seja, nao tem coluna com sample.id)
```{r}
# Substitui "-" por "." nos nomes das linhas do dataframe

rownames(alpha.pd.raw) <- gsub("-", ".", rownames(alpha.pd.raw))

# Filtra as linhas onde os nomes das linhas não terminam com ".F01"
alpha.pd <- alpha.pd.raw[!grepl("\\.F01$", rownames(alpha.pd.raw)), , drop = FALSE]

# Filtra as linhas onde os nomes das linhas terminam com ".F00"
alpha.pd <- alpha.pd.raw[grepl("\\.F00$", rownames(alpha.pd.raw)), , drop = FALSE]

write.csv(x = alpha.pd, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/alpha.pd.csv", row.names = FALSE)
```

Limpar alpha.evenness (que é dataframe, ou seja, nao tem coluna com sample.id)
```{r}
# Substitui "-" por "." nos nomes das linhas do dataframe

rownames(alpha.evenness.raw) <- gsub("-", ".", rownames(alpha.evenness.raw))

# Filtra as linhas onde os nomes das linhas não terminam com ".F01"
alpha.evenness <- alpha.evenness.raw[!grepl("\\.F01$", rownames(alpha.evenness.raw)), , drop = FALSE]

# Filtra as linhas onde os nomes das linhas terminam com ".F00"
alpha.evenness <- alpha.evenness.raw[grepl("\\.F00$", rownames(alpha.evenness.raw)), , drop = FALSE]

write.csv(x = alpha.evenness, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/alpha.evenness.csv", row.names = FALSE)
```

Limpar alpha.richness (que é dataframe, ou seja, nao tem coluna com sample.id)
```{r}
# Substitui "-" por "." nos nomes das linhas do dataframe

rownames(alpha.richness.raw) <- gsub("-", ".", rownames(alpha.richness.raw))

# Filtra as linhas onde os nomes das linhas não terminam com ".F01"
alpha.richness <- alpha.richness.raw[!grepl("\\.F01$", rownames(alpha.richness.raw)), , drop = FALSE]

# Filtra as linhas onde os nomes das linhas terminam com ".F00"
alpha.richness <- alpha.richness.raw[grepl("\\.F00$", rownames(alpha.richness.raw)), , drop = FALSE]

write.csv(x = alpha.richness, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/alpha.richness.csv", row.names = FALSE)
```

Limpar unweighted.unifrac(que foi lido como dist)

```{r}

str(unweighted_unifrac.raw)
class(unweighted_unifrac.raw)


# Converte unifract objects 'dist' em um data.frame 
# remove controls
# filter out glycerol samples

#unweighted
unweighted_unifrac <- unweighted_unifrac.raw

unweighted_unifrac <- unweighted_unifrac[ grepl(x = rownames(unweighted_unifrac), pattern =  "\\F00$" ), grepl(x = colnames(unweighted_unifrac), pattern =  "\\F00$" )]

rownames(unweighted_unifrac) <- gsub(x = rownames(unweighted_unifrac), pattern =  "-", replacement = "." )
colnames(unweighted_unifrac) <- gsub(x = colnames(unweighted_unifrac), pattern =  "-", replacement = "." )


#weighted
weighted_unifrac <- weighted_unifrac.raw

weighted_unifrac <- weighted_unifrac[ grepl(x = rownames(weighted_unifrac), pattern =  "\\F00$" ), grepl(x = colnames(weighted_unifrac), pattern =  "\\F00$" )]

rownames(weighted_unifrac) <- gsub(x = rownames(weighted_unifrac), pattern =  "-", replacement = "." )
colnames(weighted_unifrac) <- gsub(x = colnames(weighted_unifrac), pattern =  "-", replacement = "." )


```

Limpar weighted.unifrac(que foi lido como dist)

```{r}

str(weighted_unifrac.raw)
class(weighted_unifrac.raw)

# Converte o objeto 'dist' em uma matriz
weighted_unifrac.matrix <- as.matrix(weighted_unifrac.raw)

# Converte a matriz em um dataframe
weighted_unifrac <- as.data.frame(weighted_unifrac.matrix)

# Verifica o resultado
print(head(weighted_unifrac))

# Substitui "-" por "." nos nomes das linhas do dataframe

rownames(weighted_unifrac) <- gsub("-", ".", rownames(weighted_unifrac))

# Substitui "-" por "." nos nomes das colunas do dataframe

colnames(weighted_unifrac) <- gsub("-", ".", colnames(weighted_unifrac))

# Filtra as linhas onde os nomes das linhas não terminam com ".F01"
weighted_unifrac <- weighted_unifrac[!grepl("\\.F01$", rownames(weighted_unifrac)), , drop = FALSE]

# Filtra as colunas onde os nomes das colunas não terminam com ".F01"
weighted_unifrac <- weighted_unifrac[, !grepl("\\.F01$", colnames(weighted_unifrac)), drop = FALSE]

# Filtra as colunas onde os nomes das colunas terminam com ".F00"
weighted_unifrac <- weighted_unifrac[, grepl("\\.F00$", colnames(weighted_unifrac)), drop = FALSE]

# Filtra as linhas onde os nomes das linhas terminam com ".F00"
weighted_unifrac <- weighted_unifrac[grepl("\\.F00$", rownames(weighted_unifrac)), , drop = FALSE]

write.csv(x = weighted_unifrac, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/weighted_unifrac.csv", row.names = FALSE)

write.csv(x = unweighted_unifrac, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/unweighted_unifrac.csv", row.names = FALSE)

```

Filtrar t.my.asvs
```{r}

# Substitui "-" por "." nos nomes das linhas do dataframe

rownames(ASV.table.raw) <- gsub("-", ".", rownames(ASV.table.raw))


# Filtra as linhas onde os nomes das linhas não terminam com ".F01"
ASV.table <- ASV.table.raw[!grepl("\\.F01$", rownames(ASV.table.raw)), , drop = FALSE]


# Filtra as linhas onde os nomes das linhas terminam com ".F00"
ASV.table <- ASV.table[grepl("\\.F00$", rownames(ASV.table)), , drop = FALSE]

```

Juntar metadado com shannon
```{r}

metadados.shannon <- merge(metadados, alpha.shannon, by.x = "Sample.id", by.y = "row.names")

write.csv(x = metadados.shannon, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/metadados.shannon.csv", row.names = FALSE)

```

```{r}

metadados.alpha.all <- merge(metadados, alpha.all, by.x = "Sample.id", by.y = "Row.names")

write.csv(x = metadados.alpha.all, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/metadados.alpha.all.csv", row.names = FALSE)


```

Mudar o nome das colunas de Parasitológico + para ParasitologicoPositivo

```{r}
# Renomear a coluna "Parasitologico +" para "ParasitologicoPositivo"
metadados.alpha.all <- metadados.alpha.all %>%
  rename(ParasitologicoPositivo = `Parasitologico +`)

metadados.raw <- metadados.raw %>%
  rename(ParasitologicoPositivo = `Parasitologico +`)

# Verifica as primeiras linhas para confirmação
print(head(metadados.raw))
```

```{r}
# Alterar os valores "não" para "nao" na coluna "Edulcorante?" do objeto metadados.raw
metadados$`Edulcorante.` <- gsub("não", "nao", metadados$`Edulcorante.`)

# Renomear a coluna removendo o "?" do título
colnames(metadados)[colnames(metadados) == "Edulcorante."] <- "Edulcorante"

write.csv(x = metadados, 
          file = "C:/Users/polia/OneDrive/Desktop/EstatisticaR/AgrUrbana/16S_AgriUrbana/Planilhas_UrbanAgri/metadados.csv", row.names = FALSE)

```

